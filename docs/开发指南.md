# Crypto Tips 开发指南

## 项目结构

```
crypto-tips/
├── frontend/                 # React 前端应用
│   ├── src/
│   │   ├── components/      # React 组件
│   │   ├── hooks/           # 自定义 Hooks
│   │   ├── pages/           # 页面组件
│   │   ├── types/           # TypeScript 类型定义
│   │   ├── utils/           # 工具函数
│   │   └── App.tsx          # 主应用组件
│   ├── package.json
│   └── vite.config.ts
│
├── backend/                  # Node.js 后端 API
│   ├── src/
│   │   ├── controllers/     # 控制器
│   │   ├── routes/          # 路由定义
│   │   ├── middleware/      # 中间件
│   │   ├── utils/           # 工具函数
│   │   └── index.ts         # 入口文件
│   ├── prisma/
│   │   ├── schema.prisma    # 数据库模型
│   │   └── migrations/      # 数据库迁移
│   ├── package.json
│   └── tsconfig.json
│
├── docs/                     # 文档
│   ├── 五看三定分析.md
│   └── 开发指南.md
│
├── README.md
├── LICENSE
└── .gitignore
```

## 技术栈详解

### 前端技术栈

- **React 18**: UI 框架
- **TypeScript**: 类型安全
- **Vite**: 构建工具，快速的开发服务器
- **Tailwind CSS**: 实用优先的 CSS 框架
- **ethers.js v6**: 以太坊交互库
- **React Router**: 路由管理 (待集成)

### 后端技术栈

- **Node.js**: JavaScript 运行时
- **Express**: Web 框架
- **TypeScript**: 类型安全
- **Prisma**: 现代化 ORM
- **SQLite**: 轻量级数据库
- **JWT**: 身份认证 (待实现)
- **bcryptjs**: 密码加密 (待实现)

### 区块链集成

- **MetaMask**: 钱包连接
- **Ethereum**: 主链
- **Sepolia Testnet**: 测试网络
- **ethers.js**: 与区块链交互

## 本地开发设置

### 环境要求

- Node.js 18+
- npm 或 yarn
- MetaMask 浏览器扩展
- Git

### 1. 克隆项目

```bash
git clone https://github.com/yourusername/crypto-tips.git
cd crypto-tips
```

### 2. 前端设置

```bash
cd frontend
npm install
npm run dev
```

前端将运行在 http://localhost:5173

### 3. 后端设置

```bash
cd backend
npm install

# 生成 Prisma 客户端
npm run prisma:generate

# 运行数据库迁移
npm run prisma:migrate

# 启动开发服务器
npm run dev
```

后端将运行在 http://localhost:3000

### 4. 环境变量配置

后端 `.env` 文件 (参考 `.env.example`):

```env
DATABASE_URL="file:./dev.db"
PORT=3000
JWT_SECRET="your-secret-key-change-this-in-production"
```

## 核心功能实现

### 1. 钱包连接

使用 `useWallet` Hook:

```typescript
import { useWallet } from './hooks/useWallet';

function MyComponent() {
  const { address, isConnected, connectWallet } = useWallet();

  return (
    <button onClick={connectWallet}>
      {isConnected ? address : 'Connect Wallet'}
    </button>
  );
}
```

### 2. 发送打赏

使用 `web3Service`:

```typescript
import { web3Service } from './utils/web3';

const txHash = await web3Service.sendTip(
  recipientAddress,
  '0.01' // amount in ETH
);
```

### 3. 数据库操作

使用 Prisma:

```typescript
import { prisma } from './utils/prisma';

// 创建用户
const user = await prisma.user.create({
  data: {
    username: 'alice',
    walletAddress: '0x...',
  },
});

// 记录打赏
const tip = await prisma.tip.create({
  data: {
    fromAddress: '0x...',
    toAddress: '0x...',
    amount: '0.01',
    txHash: '0x...',
  },
});
```

## API 接口文档

### 用户相关

**创建用户**
```
POST /api/users
Body: {
  username: string,
  walletAddress: string,
  displayName?: string,
  bio?: string,
  avatarUrl?: string
}
```

**通过钱包地址获取用户**
```
GET /api/users/wallet/:walletAddress
```

**通过用户名获取用户**
```
GET /api/users/username/:username
```

### 打赏相关

**创建打赏记录**
```
POST /api/tips
Body: {
  fromAddress: string,
  toAddress: string,
  amount: string,
  message?: string,
  txHash: string
}
```

**获取用户的打赏记录**
```
GET /api/tips/user/:walletAddress
```

**获取接收的打赏**
```
GET /api/tips/received/:walletAddress
```

## 数据库模型

### User 表

| 字段 | 类型 | 说明 |
|------|------|------|
| id | String | UUID 主键 |
| username | String | 用户名 (唯一) |
| walletAddress | String | 钱包地址 (唯一) |
| displayName | String? | 显示名称 |
| bio | String? | 个人简介 |
| avatarUrl | String? | 头像 URL |
| createdAt | DateTime | 创建时间 |
| updatedAt | DateTime | 更新时间 |

### Tip 表

| 字段 | 类型 | 说明 |
|------|------|------|
| id | String | UUID 主键 |
| fromAddress | String | 发送方地址 |
| toAddress | String | 接收方地址 |
| amount | String | 金额 (ETH) |
| message | String? | 留言 |
| txHash | String | 交易哈希 (唯一) |
| createdAt | DateTime | 创建时间 |

## 常见问题

### 1. MetaMask 连接失败

确保:
- MetaMask 已安装并解锁
- 浏览器允许访问 MetaMask
- 网络设置正确

### 2. 交易失败

可能原因:
- Gas 费不足
- 账户余额不足
- 网络拥堵
- 拒绝签名

### 3. 数据库错误

解决方法:
```bash
# 重置数据库
npx prisma migrate reset

# 重新生成客户端
npx prisma generate
```

## 待开发功能

- [ ] 用户个人主页
- [ ] 打赏墙和排行榜
- [ ] 二维码分享
- [ ] 支持多种代币 (USDT, USDC)
- [ ] Layer 2 集成
- [ ] ENS 域名支持
- [ ] 邮件通知
- [ ] 数据分析仪表板

## 贡献指南

欢迎贡献! 请遵循以下步骤:

1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 提交 Pull Request

## 许可证

本项目采用 MIT 许可证，详见 [LICENSE](../LICENSE) 文件。
